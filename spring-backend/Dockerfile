# ğŸ”¹ 1ë‹¨ê³„: Gradle ë¹Œë“œ
FROM gradle:8.1.1-jdk17 AS build
WORKDIR /app

# Gradle ìºì‹œë¥¼ í™œìš©í•˜ê¸° ìœ„í•´ ë¨¼ì € ì¢…ì†ì„± ê´€ë ¨ íŒŒì¼ ë³µì‚¬
COPY build.gradle settings.gradle gradlew ./
COPY gradle/ ./gradle/

# ğŸ”¹ ì¢…ì†ì„±ë§Œ ë¨¼ì € ë‹¤ìš´ë¡œë“œí•˜ì—¬ ìºì‹œ ì ìš©
RUN ./gradlew dependencies

# ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬ í›„ ë¹Œë“œ ì‹¤í–‰ (ìºì‹œ ìµœì í™”)
COPY src/ ./src/
RUN ./gradlew build -x test

# ğŸ”¹ 2ë‹¨ê³„: ê²½ëŸ‰í™”ëœ ì‹¤í–‰ í™˜ê²½
FROM openjdk:17-jdk-slim
WORKDIR /app

# ë¹Œë“œëœ JAR íŒŒì¼ì„ ìë™ìœ¼ë¡œ ì°¾ì•„ì„œ ë³µì‚¬
COPY --from=build /app/build/libs/*.jar app.jar

EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
